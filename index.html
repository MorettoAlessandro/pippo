<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creazione Rapportini</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Creazione Rapportini</h1>

        <form id="rapportino-form">
            <div class="form-group">
                <label for="tecnico">Tecnico</label>
                <select id="tecnico" name="tecnico" required>
                    <option value="">Seleziona Tecnico</option>
                    <!-- Opzioni tecnici verranno caricate dinamicamente -->
                </select>
            </div>

            <div class="form-group">
                <label for="cliente">Cliente</label>
                <select id="cliente" name="cliente" required>
                    <option value="">Seleziona Cliente</option>
                    <!-- Opzioni clienti verranno caricate dinamicamente -->
                </select>
            </div>

            <div class="form-group">
                <label for="data">Data e Ora</label>
                <input type="datetime-local" id="data" name="data" required>
            </div>

            <div class="form-group">
                <label>Tipo di Rapportino</label>
                <div class="radio-group">
                    <label><input type="radio" name="tipo" value="commessa"> Commessa</label>
                    <label><input type="radio" name="tipo" value="helpdesk"> Help Desk</label>
                    <label><input type="radio" name="tipo" value="remoto"> Remoto</label>
                </div>
            </div>

            <div id="numero-rapportino-group" class="form-group" style="display: none;">
                <label for="numero-rapportino">Numero Ticket</label>
                <input type="text" id="numero-rapportino" name="numero-rapportino">
            </div>

            <div id="referente-richiesta-group" class="form-group" style="display: none;">
                <label for="referente-richiesta">Referente Richiesta</label>
                <input type="text" id="referente-richiesta" name="referente-richiesta">
            </div>

            <div id="commessa-group" class="form-group" style="display: none;">
                <label for="numero-commessa">Numero Commessa</label>
                <input type="text" id="numero-commessa" name="numero-commessa">
            </div>

            <div id="trasferta-group" class="form-group" style="display: none;">
                <label for="trasferta">Trasferta (in km)</label>
                <input type="number" id="trasferta" name="trasferta">
            </div>

            <div id="tempo-group" class="form-group" style="display: none;">
                <label for="tempo-impegnato">Tempo Impegnato</label>
                <input type="text" id="tempo-impegnato" name="tempo-impegnato" readonly>
            </div>

            <div class="form-group">
                <label for="descrizione">Descrizione</label>
                <textarea id="descrizione" name="descrizione" rows="4" required></textarea>
            </div>

            <button type="submit" class="btn-submit">Invia Rapportino</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tipoRadios = document.querySelectorAll('input[name="tipo"]');
            const numeroRapportinoGroup = document.getElementById('numero-rapportino-group');
            const referenteRichiestaGroup = document.getElementById('referente-richiesta-group');
            const commessaGroup = document.getElementById('commessa-group');
            const trasfertaGroup = document.getElementById('trasferta-group');
            const tempoGroup = document.getElementById('tempo-group');
            const tempoImpegnato = document.getElementById('tempo-impegnato');

            tipoRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const tipo = this.value;

                    if (tipo === 'helpdesk') {
                        numeroRapportinoGroup.style.display = 'block';
                        referenteRichiestaGroup.style.display = 'block';
                        tempoGroup.style.display = 'none';
                        commessaGroup.style.display = 'none';
                        trasfertaGroup.style.display = 'none';
                    } else if (tipo === 'remoto') {
                        numeroRapportinoGroup.style.display = 'none';
                        referenteRichiestaGroup.style.display = 'none';
                        tempoGroup.style.display = 'none';
                        commessaGroup.style.display = 'none';
                        trasfertaGroup.style.display = 'none';
                    } else if (tipo === 'commessa') {
                        numeroRapportinoGroup.style.display = 'none';
                        referenteRichiestaGroup.style.display = 'none';
                        tempoGroup.style.display = 'none';
                        commessaGroup.style.display = 'block';
                        trasfertaGroup.style.display = 'block';
                    } else {
                        numeroRapportinoGroup.style.display = 'none';
                        referenteRichiestaGroup.style.display = 'none';
                        tempoGroup.style.display = 'none';
                        commessaGroup.style.display = 'none';
                        trasfertaGroup.style.display = 'none';
                    }
                });
            });

            document.getElementById('rapportino-form').addEventListener('submit', function(event) {
                event.preventDefault();

                const tecnico = document.getElementById('tecnico').value;
                const cliente = document.getElementById('cliente').value;
                const data = document.getElementById('data').value;
                const tipo = document.querySelector('input[name="tipo"]:checked').value;
                const numeroRapportino = document.getElementById('numero-rapportino').value;
                const referenteRichiesta = document.getElementById('referente-richiesta').value;
                const numeroCommessa = document.getElementById('numero-commessa').value;
                const trasferta = document.getElementById('trasferta').value;
                const tempoImpegnato = document.getElementById('tempo-impegnato').value;
                const descrizione = document.getElementById('descrizione').value;

                if (tecnico && cliente && data && tipo && (tipo !== 'commessa' || numeroCommessa) && (tipo !== 'helpdesk' || numeroRapportino) && (tipo === 'remoto' ? true : tempoImpegnato) && descrizione) {
                    const rapportino = {
                        tecnico,
                        cliente,
                        data,
                        tipo,
                        numeroRapportino: tipo === 'helpdesk' ? numeroRapportino : '',
                        referenteRichiesta: tipo === 'helpdesk' ? referenteRichiesta : '',
                        numeroCommessa: tipo === 'commessa' ? numeroCommessa : '',
                        trasferta: tipo === 'commessa' ? trasferta : '',
                        tempoImpegnato: tipo === 'remoto' ? tempoImpegnato : '',
                        descrizione,
                        stato: 'in attesa'
                    };

                    const rapportini = JSON.parse(localStorage.getItem('rapportini')) || [];
                    rapportini.push(rapportino);
                    localStorage.setItem('rapportini', JSON.stringify(rapportini));

                    // Resetta il modulo
                    document.getElementById('rapportino-form').reset();
                    numeroRapportinoGroup.style.display = 'none';
                    referenteRichiestaGroup.style.display = 'none';
                    tempoGroup.style.display = 'none';
                    commessaGroup.style.display = 'none';
                    trasfertaGroup.style.display = 'none';
                } else {
                    alert('Compila tutti i campi obbligatori.');
                }
            });
        });
    </script>
</body>
</html>
